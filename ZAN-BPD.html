<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ZAN-BPD – Échelle de Zanarini</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    
    :root {
      --primary: #8b7bb8;
      --primary-light: #b4a5d4;
      --primary-dark: #6d5f94;
      --accent: #d4a5c4;
      --bg-main: #f8f6fb;
      --bg-card: #ffffff;
      --text-primary: #2d2640;
      --text-secondary: #6b5d7f;
      --text-muted: #9b8db0;
      --border: #e8e3f0;
      --success: #7fb89e;
      --warning: #e8b86d;
      --danger: #d88d9a;
      --shadow-sm: 0 2px 8px rgba(139, 123, 184, 0.08);
      --shadow-md: 0 4px 16px rgba(139, 123, 184, 0.12);
      --shadow-lg: 0 8px 32px rgba(139, 123, 184, 0.16);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #f8f6fb 0%, #efe9f7 100%);
      color: var(--text-primary);
      line-height: 1.7;
      padding: 1.5rem;
      min-height: 100vh;
    }
    
    .container {
      max-width: 56rem;
      margin: 0 auto;
      background: var(--bg-card);
      border-radius: 24px;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      animation: fadeIn 0.6s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      padding: 2rem 2rem 1.5rem;
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -10%;
      width: 300px;
      height: 300px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      animation: float 8s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(-20px, 20px) scale(1.1); }
    }
    
    header h1 {
      font-size: clamp(1.5rem, 4vw, 2rem);
      font-weight: 700;
      margin-bottom: 0.5rem;
      position: relative;
      z-index: 1;
    }
    
    header .subtitle {
      font-size: 1rem;
      opacity: 0.95;
      font-weight: 400;
      position: relative;
      z-index: 1;
    }
    
    .toolbar {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-top: 1rem;
      position: relative;
      z-index: 1;
    }
    
    .btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 0.6rem 1.1rem;
      border-radius: 12px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .btn:hover:not([disabled]) {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-secondary:hover:not([disabled]) {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .btn-secondary[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .section {
      padding: 2rem;
      border-top: 1px solid var(--border);
    }
    
    .instructions {
      background: linear-gradient(135deg, #f0ebf8 0%, #faf7fd 100%);
      color: var(--text-primary);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 2rem;
      border: 1px solid var(--border);
      animation: slideIn 0.5s ease 0.2s both;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .instructions strong {
      color: var(--primary-dark);
    }
    
    .question {
      padding: 1.5rem 0;
      border-bottom: 1px solid var(--border);
      animation: slideIn 0.5s ease both;
      transition: all 0.3s ease;
    }
    
    .question:hover {
      background: linear-gradient(90deg, transparent 0%, rgba(139, 123, 184, 0.03) 50%, transparent 100%);
      padding-left: 0.5rem;
      padding-right: 0.5rem;
      margin-left: -0.5rem;
      margin-right: -0.5rem;
      border-radius: 12px;
    }
    
    .question:last-child {
      border-bottom: none;
    }
    
    .qtext {
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--text-primary);
      font-size: 1.05rem;
    }
    
    .qnumber {
      display: inline-block;
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--accent) 100%);
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      text-align: center;
      line-height: 28px;
      font-size: 0.85rem;
      font-weight: 700;
      margin-right: 0.75rem;
    }
    
    .scale-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
      gap: 0.75rem;
      margin-top: 0.75rem;
    }
    
    .scale-container input[type="radio"] {
      display: none;
    }
    
    .scale-container label {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem 0.5rem;
      border: 2px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: var(--bg-card);
      text-align: center;
      min-height: 90px;
    }
    
    .scale-container label:hover {
      border-color: var(--primary-light);
      background: linear-gradient(135deg, rgba(139, 123, 184, 0.05) 0%, rgba(212, 165, 196, 0.05) 100%);
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }
    
    .scale-container input[type="radio"]:checked + label {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      border-color: var(--primary);
      box-shadow: var(--shadow-md);
      transform: scale(1.05);
    }
    
    .scale-value {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }
    
    .scale-label {
      font-size: 0.85rem;
      font-weight: 500;
      opacity: 0.9;
    }
    
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      justify-content: center;
      margin-top: 2rem;
    }
    
    button.primary {
      background: linear-gradient(135deg, var(--success) 0%, #6fa88a 100%);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 14px;
      font-weight: 700;
      font-size: 1.05rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-md);
    }
    
    button.primary:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }
    
    .validation {
      color: var(--danger);
      text-align: center;
      font-weight: 600;
      display: none;
      padding: 1rem;
      background: rgba(216, 141, 154, 0.1);
      border-radius: 12px;
      border: 1px solid var(--danger);
    }
    
    #results {
      display: none;
      animation: fadeIn 0.6s ease;
    }
    
    .grid {
      display: grid;
      gap: 1.5rem;
    }
    
    .panel {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 246, 251, 0.9) 100%);
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
    }
    
    .panel:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }
    
    .panel h3 {
      font-size: 1.15rem;
      margin-bottom: 1rem;
      color: var(--primary-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .panel h3::before {
      content: '';
      width: 4px;
      height: 1.5rem;
      background: linear-gradient(180deg, var(--primary) 0%, var(--accent) 100%);
      border-radius: 2px;
    }
    
    .bigscore {
      display: flex;
      align-items: baseline;
      gap: 0.75rem;
      font-weight: 800;
      font-size: 2.5rem;
      color: var(--primary);
      margin: 0.5rem 0;
    }
    
    .bigscore small {
      font-size: 1.25rem;
      color: var(--text-muted);
      font-weight: 600;
    }
    
    .severity-badge {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    .severity-minimal { background: rgba(127, 184, 158, 0.2); color: var(--success); }
    .severity-mild { background: rgba(232, 184, 109, 0.2); color: #c89a3d; }
    .severity-moderate { background: rgba(232, 144, 109, 0.2); color: #c87a3d; }
    .severity-severe { background: rgba(216, 141, 154, 0.2); color: var(--danger); }
    
    .summary-box {
      background: linear-gradient(135deg, rgba(139, 123, 184, 0.08) 0%, rgba(212, 165, 196, 0.08) 100%);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 1.5rem;
      margin-top: 1.5rem;
    }
    
    .probability-indicator {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      padding: 1rem;
      background: white;
      border-radius: 12px;
      box-shadow: var(--shadow-sm);
    }
    
    .probability-circle {
      min-width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 800;
      color: white;
      box-shadow: var(--shadow-md);
    }
    
    .probability-text {
      flex: 1;
    }
    
    .probability-text .label {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--primary-dark);
      margin-bottom: 0.25rem;
    }
    
    .probability-text .desc {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    .criteria-count {
      display: inline-block;
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      color: white;
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    .barwrap {
      margin-top: 1.5rem;
    }
    
    .bar {
      height: 12px;
      width: 100%;
      background: linear-gradient(90deg, #f0ebf8 0%, #e8e3f0 100%);
      border-radius: 999px;
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
    }
    
    .fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-light) 0%, var(--primary) 50%, var(--accent) 100%);
      width: 0%;
      transition: width 1s ease;
      border-radius: 999px;
      box-shadow: 0 0 8px rgba(139, 123, 184, 0.4);
    }
    
    .threshold-markers {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    
    .threshold-marker {
      text-align: center;
      flex: 1;
    }
    
    details.accordion {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 1rem 1.25rem;
      margin-top: 1rem;
      background: white;
      transition: all 0.3s ease;
    }
    
    details.accordion:hover {
      box-shadow: var(--shadow-sm);
    }
    
    details.accordion[open] {
      box-shadow: var(--shadow-md);
    }
    
    details.accordion summary {
      cursor: pointer;
      font-weight: 700;
      color: var(--primary-dark);
      list-style: none;
      outline: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.25rem 0;
    }
    
    details.accordion summary::-webkit-details-marker {
      display: none;
    }
    
    details.accordion summary::after {
      content: '▸';
      font-size: 1.2rem;
      transition: transform 0.3s ease;
      color: var(--primary);
    }
    
    details.accordion[open] summary::after {
      transform: rotate(90deg);
    }
    
    details.accordion .content {
      padding-top: 1rem;
      color: var(--text-secondary);
      line-height: 1.8;
    }
    
    .criteria-grid {
      display: grid;
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .criterion-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(248, 246, 251, 0.8) 100%);
      transition: all 0.3s ease;
    }
    
    .criterion-card:hover {
      box-shadow: var(--shadow-sm);
      transform: translateX(4px);
    }
    
    .criterion-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .criterion-name {
      font-weight: 700;
      color: var(--primary-dark);
      font-size: 0.95rem;
    }
    
    .criterion-score {
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.9rem;
    }
    
    .criterion-desc {
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    
    .consent {
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
      background: linear-gradient(135deg, rgba(232, 184, 109, 0.15) 0%, rgba(255, 251, 234, 0.15) 100%);
      border: 1px solid rgba(232, 184, 109, 0.3);
      color: var(--text-primary);
      padding: 1rem;
      border-radius: 12px;
      margin-top: 1rem;
    }
    
    .consent input[type="checkbox"] {
      margin-top: 0.25rem;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .note {
      color: var(--text-muted);
      font-size: 0.95rem;
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(139, 123, 184, 0.05);
      border-radius: 10px;
      border-left: 3px solid var(--primary);
    }
    
    .note strong {
      color: var(--primary-dark);
    }
    
    .small {
      font-size: 0.9rem;
      color: var(--text-muted);
    }
    
    footer {
      padding: 1.5rem 2rem;
      color: var(--text-muted);
      font-size: 0.9rem;
      background: linear-gradient(135deg, #fafafa 0%, #f5f3f8 100%);
      border-top: 1px solid var(--border);
      line-height: 1.8;
    }
    
    @media (max-width: 640px) {
      body {
        padding: 0.75rem;
      }
      
      .section {
        padding: 1.5rem 1rem;
      }
      
      header {
        padding: 1.5rem 1rem 1rem;
      }
      
      .scale-container {
        grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
      }
      
      .bigscore {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ZAN-BPD</h1>
      <div class="subtitle">Échelle de Zanarini pour le Trouble de la Personnalité Borderline</div>
      <div class="toolbar">
        <label class="btn" for="file-import">Importer un résultat</label>
        <input type="file" id="file-import" accept=".json" style="display:none"/>
      </div>
    </header>

    <div class="instructions">
      <p><strong>Période de référence :</strong> la semaine écoulée (7 derniers jours)</p>
      <p style="margin-top: 0.5rem;">Pour chaque critère ci-dessous, évaluez l'intensité et la fréquence des symptômes durant cette période. <strong>Toutes les questions doivent être complétées</strong> pour calculer les scores. Cet outil est un questionnaire de suivi de la sévérité, non un instrument diagnostique.</p>
      
      <div style="margin-top: 1rem; display: flex; align-items: center; gap: 1rem;">
        <label for="eval-date" style="font-weight: 600;">Date de l'évaluation :</label>
        <input type="date" id="eval-date" style="padding: 0.5rem; border: 1px solid var(--border); border-radius: 8px; font-family: inherit; font-size: 0.95rem;"/>
      </div>
    </div>

    <form id="zan-form" class="section">
      <div id="qwrap"></div>

      <div class="actions">
        <button type="submit" class="primary">Calculer les résultats</button>
        <p id="valmsg" class="validation">Veuillez répondre à toutes les questions.</p>
      </div>

      <div id="results" class="section">
        <div class="grid">
          <div class="panel">
            <h3>Score de sévérité</h3>
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
              <div class="bigscore">
                <span id="totalscore">0</span>
                <small>/ 36</small>
              </div>
              <div id="severity-badge"></div>
            </div>
            <p id="eval-date-display" style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;"></p>
            
            <div class="barwrap">
              <div class="bar">
                <div class="fill" id="fill"></div>
              </div>
              <div class="threshold-markers">
                <div class="threshold-marker">
                  <div style="font-weight: 600;">0</div>
                  <div>Minimal</div>
                </div>
                <div class="threshold-marker">
                  <div style="font-weight: 600;">9</div>
                  <div>Léger</div>
                </div>
                <div class="threshold-marker">
                  <div style="font-weight: 600;">18</div>
                  <div>Modéré</div>
                </div>
                <div class="threshold-marker">
                  <div style="font-weight: 600;">27</div>
                  <div>Marqué</div>
                </div>
                <div class="threshold-marker">
                  <div style="font-weight: 600;">36</div>
                  <div>Sévère</div>
                </div>
              </div>
            </div>

            <div class="summary-box">
              <p id="interp" style="font-size: 1.05rem; font-weight: 600; color: var(--primary-dark);"></p>
            </div>

            <details class="accordion">
              <summary>Interprétation détaillée</summary>
              <div class="content">
                <div id="interp-long"></div>
              </div>
            </details>
            
            <details class="accordion">
              <summary>Probabilité selon critères DSM-5</summary>
              <div class="content">
                <div id="probability-result"></div>
                <p class="note" style="margin-top: 1rem;">
                  <strong>Note importante :</strong> Cette estimation de probabilité est fournie à titre informatif uniquement. 
                  La ZAN-BPD est principalement conçue pour le <strong>suivi de la sévérité</strong> des symptômes dans le temps, 
                  pas pour poser un diagnostic. Seul un professionnel qualifié peut établir un diagnostic de TPB après une 
                  évaluation clinique complète et longitudinale.
                </p>
              </div>
            </details>

            <details class="accordion">
              <summary>Pour les patients — comprendre votre résultat</summary>
              <div class="content">
                <p><strong>Qu'est-ce que la ZAN-BPD ?</strong></p>
                <p>La ZAN-BPD est une échelle qui mesure la sévérité des symptômes associés au trouble de la personnalité borderline durant la semaine écoulée. Elle évalue 9 critères correspondant aux critères diagnostiques du DSM-5.</p>
                
                <p style="margin-top: 1rem;"><strong>Objectif principal : le suivi de la sévérité</strong></p>
                <p>Cette échelle est conçue pour <strong>suivre l'évolution</strong> de vos symptômes dans le temps, pas pour poser un diagnostic. Elle vous permet, ainsi qu'à votre thérapeute, de :</p>
                <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                  <li>Mesurer l'intensité actuelle de vos difficultés</li>
                  <li>Observer les changements d'une semaine à l'autre</li>
                  <li>Évaluer l'efficacité des traitements ou stratégies mises en place</li>
                  <li>Identifier les périodes plus difficiles nécessitant un ajustement du suivi</li>
                </ul>
                
                <p class="note" style="margin-top: 1rem;"><strong>Important :</strong> Un score élevé ne signifie pas nécessairement que vous avez un TPB. Il indique que vous vivez actuellement des difficultés importantes qui méritent attention et soutien. Seul un professionnel de santé qualifié peut poser un diagnostic après une évaluation complète.</p>
                
                <p style="margin-top: 1rem;"><strong>Comment utiliser vos résultats ?</strong></p>
                <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                  <li><strong>Suivi régulier :</strong> Vous pouvez remplir cette échelle chaque semaine pour suivre votre évolution</li>
                  <li><strong>Exportez vos résultats :</strong> Conservez-les pour les partager avec votre thérapeute ou pour observer vos progrès sur plusieurs semaines</li>
                  <li><strong>Dialogue thérapeutique :</strong> Utilisez ces scores pour discuter avec votre professionnel de santé de ce qui a été difficile ou de ce qui s'améliore</li>
                  <li><strong>Si le score est élevé (≥19) de façon persistante :</strong> Discutez-en avec un professionnel pour adapter votre prise en charge</li>
                </ul>
                
                <p style="margin-top: 1rem;"><strong>À propos de la "Probabilité DSM-5"</strong></p>
                <p>Cette estimation (visible dans l'accordéon dédié) est fournie à titre informatif mais n'est <strong>pas l'objectif principal</strong> de cette échelle. Elle compte simplement le nombre de critères significativement présents. Le diagnostic réel nécessite bien plus qu'un score : une évaluation longitudinale, le contexte développemental, l'exclusion d'autres troubles, etc.</p>
              </div>
            </details>

            <details class="accordion">
              <summary>Pour les cliniciens — utilisation de l'échelle</summary>
              <div class="content">
                <p><strong>Objectif principal : mesure de la sévérité et suivi longitudinal</strong></p>
                <p>La ZAN-BPD est une échelle dimensionnelle conçue pour :</p>
                <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                  <li><strong>Évaluer la sévérité actuelle</strong> des symptômes borderline (semaine écoulée)</li>
                  <li><strong>Suivre l'évolution symptomatique</strong> dans le temps (administrations répétées)</li>
                  <li><strong>Mesurer la réponse au traitement</strong> (psychothérapie, pharmacothérapie)</li>
                  <li><strong>Objectiver les fluctuations</strong> et identifier les périodes de décompensation</li>
                </ul>
                
                <p class="note" style="margin-top: 1rem;"><strong>Limite majeure :</strong> La ZAN-BPD n'est <strong>pas</strong> un outil diagnostique autonome. Elle évalue une période de 7 jours, alors que le diagnostic de TPB nécessite une persistance des symptômes depuis l'adolescence/début de l'âge adulte, une évaluation longitudinale, et l'exclusion d'autres troubles.</p>
                
                <p style="margin-top: 1rem;"><strong>Interprétation de la sévérité (usage principal)</strong></p>
                <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                  <li><strong>0-9 (minimal) :</strong> Symptômes absents ou sous-cliniques. Période de stabilité ou rémission partielle.</li>
                  <li><strong>10-18 (léger à modéré) :</strong> Symptômes présents mais gérables. Surveillance, interventions ciblées, ajustement des stratégies d'adaptation.</li>
                  <li><strong>19-27 (modéré à marqué) :</strong> Symptômes significatifs impactant le fonctionnement. Intensification du suivi, psychothérapie structurée (TCD, TBM, schéma thérapie), évaluation pharmacologique.</li>
                  <li><strong>28-36 (sévère) :</strong> Décompensation significative. Évaluation du risque suicidaire, intensification urgente du traitement, considération d'une hospitalisation si sécurité compromise.</li>
                </ul>
                
                <p style="margin-top: 1rem;"><strong>Usage en suivi thérapeutique</strong></p>
                <p>Administration recommandée :</p>
                <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                  <li><strong>Hebdomadaire</strong> en phase aiguë ou décompensation</li>
                  <li><strong>Bimensuelle à mensuelle</strong> en phase de stabilisation</li>
                  <li><strong>Mensuelle</strong> en phase d'entretien</li>
                </ul>
                <p>Interprétez les fluctuations dans leur contexte : événements de vie, adhésion thérapeutique, changements thérapeutiques récents, comorbidités actives.</p>
                
                <p style="margin-top: 1rem;"><strong>À propos de la "Probabilité DSM-5" (usage secondaire)</strong></p>
                <p>L'estimation de probabilité (basée sur le décompte des critères ≥2) est fournie pour contexte mais présente des limites importantes :</p>
                <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                  <li><strong>Fenêtre temporelle inadéquate :</strong> 7 jours vs critère de persistance du DSM-5</li>
                  <li><strong>Pas de pondération :</strong> tous les critères comptent égal (alors que cliniquement, certains ont plus de poids)</li>
                  <li><strong>Pas de contextualisation :</strong> ne considère pas l'histoire développementale, les comorbidités, le fonctionnement global</li>
                  <li><strong>Risque de sur-diagnostic :</strong> une décompensation aiguë (trauma récent, deuil, stress majeur) peut donner un score élevé sans TPB sous-jacent</li>
                </ul>
                
                <p class="note" style="margin-top: 1rem;"><strong>Recommandation clinique :</strong> Utilisez prioritairement le <strong>score de sévérité</strong> pour le suivi. Pour le diagnostic initial, privilégiez les entretiens structurés validés (SCID-II, IPDE, DIB-R) et l'évaluation clinique longitudinale. La ZAN-BPD excelle dans le suivi d'efficacité thérapeutique, pas dans le dépistage diagnostique.</p>
                
                <p style="margin-top: 1rem;"><strong>Considérations différentielles</strong></p>
                <p>Un score élevé peut refléter :</p>
                <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                  <li>TPB (si contexte clinique cohérent)</li>
                  <li>TSPT complexe (chevauchement symptomatique important)</li>
                  <li>Trouble bipolaire en phase mixte/dépressive</li>
                  <li>TDAH avec dysrégulation émotionnelle sévère</li>
                  <li>Réaction aiguë à un stress majeur</li>
                </ul>
              </div>
            </details>
          </div>

          <details class="accordion">
            <summary>Scores par critère DSM-5</summary>
            <div class="content">
              <p class="small" style="margin-bottom: 1rem;">Détail de vos scores pour chaque critère (0 = absent, 4 = sévère/quotidien)</p>
              <div class="criteria-grid" id="criteria-scores"></div>
            </div>
          </details>

          <div class="panel">
            <h3>Exporter votre résultat</h3>
            <p class="small">Aucun stockage local n'est effectué. Pour exporter, cochez la case de consentement puis cliquez sur « Exporter ».</p>
            <label class="consent">
              <input type="checkbox" id="consent"/>
              <span>J'autorise l'export de mes réponses au format JSON (à conserver par moi). Ces données resteront confidentielles et ne seront pas transmises.</span>
            </label>
            <div class="actions" style="justify-content:flex-start; margin-top: 1rem;">
              <button type="button" id="btn-export" class="btn-secondary" disabled>Exporter</button>
            </div>
          </div>
        </div>
      </div>
    </form>

    <footer>
      <p><strong>© Mary C. Zanarini, PhD – McLean Hospital, Harvard Medical School</strong></p>
      <p style="margin-top: 0.5rem;">La ZAN-BPD est un outil validé pour mesurer la sévérité des symptômes borderline. Usage clinique et recherche avec attribution appropriée. Aucune donnée n'est stockée localement.</p>
      <p style="margin-top: 0.5rem;">Adapté en version interactive par Dr FENOHASINA Toto Jean Felicien (Psychiatre - FFI).</p>
    </footer>
  </div>

  <script>
    // Définition des critères (9 critères DSM-5)
    const criteria = [
      {
        num: 1,
        name: "Efforts effrénés pour éviter l'abandon",
        question: "Avez-vous fait des efforts importants pour éviter d'être abandonné(e) (réel ou imaginé) ?",
        examples: "Ex : appels répétés, menaces, comportements désespérés pour retenir quelqu'un"
      },
      {
        num: 2,
        name: "Relations instables et intenses",
        question: "Avez-vous vécu des relations qui alternent entre idéalisation et dévalorisation extrêmes ?",
        examples: "Ex : passer de 'tu es parfait(e)' à 'je te déteste' rapidement"
      },
      {
        num: 3,
        name: "Perturbations de l'identité",
        question: "Avez-vous eu l'impression de ne pas savoir qui vous êtes vraiment ?",
        examples: "Ex : sentiment de ne pas avoir d'identité stable, confusion sur ses valeurs/objectifs"
      },
      {
        num: 4,
        name: "Impulsivité",
        question: "Avez-vous agi de manière impulsive dans au moins 2 domaines potentiellement dommageables ?",
        examples: "Ex : dépenses excessives, sexualité à risque, abus de substances, conduite dangereuse, crises de boulimie"
      },
      {
        num: 5,
        name: "Comportements suicidaires ou automutilations",
        question: "Avez-vous eu des gestes suicidaires, des menaces ou des comportements d'automutilation ?",
        examples: "Ex : scarifications, tentatives de suicide, menaces suicidaires"
      },
      {
        num: 6,
        name: "Instabilité affective",
        question: "Votre humeur a-t-elle changé de manière rapide et intense ?",
        examples: "Ex : passer de la tristesse à la colère à l'euphorie en quelques heures"
      },
      {
        num: 7,
        name: "Sentiments chroniques de vide",
        question: "Vous êtes-vous senti(e) vide intérieurement de manière persistante ?",
        examples: "Ex : sensation de vide émotionnel, impression d'être creux/creuse"
      },
      {
        num: 8,
        name: "Colères intenses et inappropriées",
        question: "Avez-vous ressenti des colères intenses difficiles à contrôler ?",
        examples: "Ex : explosions de rage, difficulté à contrôler sa colère, conflits fréquents"
      },
      {
        num: 9,
        name: "Idéation paranoïaque ou dissociation",
        question: "Avez-vous eu des moments où vous pensiez qu'on vous voulait du mal ou vous vous sentiez déconnecté(e) ?",
        examples: "Ex : sentiment que les autres complotent contre vous, sensation de se regarder de l'extérieur"
      }
    ];

    const scaleOptions = [
      { value: 0, label: "Absent", desc: "Aucun symptôme" },
      { value: 1, label: "Léger", desc: "Rare/minime" },
      { value: 2, label: "Modéré", desc: "Occasionnel" },
      { value: 3, label: "Marqué", desc: "Fréquent" },
      { value: 4, label: "Sévère", desc: "Quotidien/extrême" }
    ];

    // Initialiser la date du jour
    const evalDateInput = document.getElementById('eval-date');
    const today = new Date().toISOString().split('T')[0];
    evalDateInput.value = today;

    // Génération du formulaire
    const qwrap = document.getElementById('qwrap');
    criteria.forEach((crit, i) => {
      const div = document.createElement('div');
      div.className = 'question';
      div.style.animationDelay = `${i * 0.05}s`;
      
      const scaleHTML = scaleOptions.map(opt => `
        <div>
          <input type="radio" id="q${crit.num}_${opt.value}" name="q${crit.num}" value="${opt.value}"/>
          <label for="q${crit.num}_${opt.value}">
            <div class="scale-value">${opt.value}</div>
            <div class="scale-label">${opt.label}</div>
          </label>
        </div>
      `).join('');
      
      div.innerHTML = `
        <div class="qtext">
          <span class="qnumber">${crit.num}</span>${crit.name}
        </div>
        <div style="color: var(--text-secondary); font-size: 0.95rem; margin-bottom: 0.75rem; margin-left: 2.5rem;">
          ${crit.question}
        </div>
        <div style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 1rem; margin-left: 2.5rem; font-style: italic;">
          ${crit.examples}
        </div>
        <div class="scale-container">${scaleHTML}</div>
      `;
      qwrap.appendChild(div);
    });

    // Fonctions d'interprétation
    function getProbabilityInfo(scores) {
      // Compter le nombre de critères "significativement présents" (≥2)
      let significantCriteria = 0;
      for (let i = 1; i <= criteria.length; i++) {
        if (scores[`q${i}`] >= 2) {
          significantCriteria++;
        }
      }
      
      // Calculer la probabilité basée sur les critères DSM-5
      // DSM-5 nécessite 5 critères sur 9 pour le diagnostic
      let probability, probabilityClass, probabilityColor, probabilityDesc;
      
      if (significantCriteria < 3) {
        probability = "Faible";
        probabilityClass = "severity-minimal";
        probabilityColor = "var(--success)";
        probabilityDesc = "Moins de 3 critères significatifs. Peu probable selon les critères DSM-5.";
      } else if (significantCriteria < 5) {
        probability = "Modérée";
        probabilityClass = "severity-mild";
        probabilityColor = "#c89a3d";
        probabilityDesc = `${significantCriteria} critères significatifs. En dessous du seuil DSM-5 (5 critères requis), mais présence de difficultés notables.`;
      } else if (significantCriteria < 7) {
        probability = "Élevée";
        probabilityClass = "severity-moderate";
        probabilityColor = "#c87a3d";
        probabilityDesc = `${significantCriteria} critères significatifs. Au-dessus du seuil DSM-5 (5 critères), suggérant une forte probabilité de TPB.`;
      } else {
        probability = "Très élevée";
        probabilityClass = "severity-severe";
        probabilityColor = "var(--danger)";
        probabilityDesc = `${significantCriteria} critères significatifs sur 9. Nettement au-dessus du seuil DSM-5, suggérant une très forte probabilité de TPB.`;
      }
      
      return {
        probability,
        probabilityClass,
        probabilityColor,
        probabilityDesc,
        significantCriteria
      };
    }
    
    function getSeverityInfo(total) {
      if (total <= 9) {
        return {
          label: "Symptômes minimes",
          class: "severity-minimal",
          shortDesc: "Symptômes absents ou minimes",
          longDesc: "Votre score indique une absence ou une présence minime de symptômes borderline durant la semaine écoulée. Cela suggère un fonctionnement relativement stable sur cette période. Si toutefois vous ressentez des difficultés dans votre vie quotidienne, n'hésitez pas à en discuter avec un professionnel de santé."
        };
      } else if (total <= 18) {
        return {
          label: "Sévérité légère à modérée",
          class: "severity-mild",
          shortDesc: "Symptômes légers à modérés",
          longDesc: "Votre score indique la présence de symptômes borderline d'intensité légère à modérée durant la semaine écoulée. Ces symptômes peuvent impacter votre quotidien de manière variable. Une consultation avec un professionnel de santé mentale peut être bénéfique pour évaluer vos besoins et discuter d'éventuelles stratégies d'adaptation ou interventions thérapeutiques (psychothérapie, gestion de crise)."
        };
      } else if (total <= 27) {
        return {
          label: "Sévérité modérée à marquée",
          class: "severity-moderate",
          shortDesc: "Symptômes modérés à marqués",
          longDesc: "Votre score indique la présence de symptômes borderline d'intensité modérée à marquée durant la semaine écoulée. Ces symptômes ont probablement un impact significatif sur votre fonctionnement quotidien (relations, travail, bien-être). Une prise en charge thérapeutique structurée est fortement recommandée. Les approches validées incluent la thérapie comportementale dialectique (TCD), la thérapie basée sur la mentalisation (TBM), ou la thérapie des schémas."
        };
      } else {
        return {
          label: "Sévérité sévère",
          class: "severity-severe",
          shortDesc: "Symptômes sévères",
          longDesc: "Votre score indique la présence de symptômes borderline sévères durant la semaine écoulée. Ces symptômes ont très probablement un impact majeur sur votre vie quotidienne et peuvent compromettre votre sécurité ou celle d'autrui. Une consultation urgente avec un professionnel de santé mentale est vivement recommandée. Une intensification du traitement peut être nécessaire, incluant un suivi rapproché, une évaluation du risque suicidaire, et dans certains cas, une hospitalisation si la situation le justifie."
        };
      }
    }

    // Gestion du formulaire
    const form = document.getElementById('zan-form');
    const valmsg = document.getElementById('valmsg');
    const results = document.getElementById('results');
    const totalscoreEl = document.getElementById('totalscore');
    const fill = document.getElementById('fill');
    const severityBadge = document.getElementById('severity-badge');
    const evalDateDisplay = document.getElementById('eval-date-display');
    const probabilityResult = document.getElementById('probability-result');
    const interp = document.getElementById('interp');
    const interpLong = document.getElementById('interp-long');
    const criteriaScores = document.getElementById('criteria-scores');

    function computeAndRender(answers) {
      // Vérifier complétude
      for (let i = 1; i <= criteria.length; i++) {
        if (answers[`q${i}`] === undefined) {
          valmsg.style.display = 'block';
          results.style.display = 'none';
          return false;
        }
      }
      valmsg.style.display = 'none';

      // Calculer le score total
      let total = 0;
      const scores = {};
      for (let i = 1; i <= criteria.length; i++) {
        const score = parseInt(answers[`q${i}`]);
        scores[`q${i}`] = score;
        total += score;
      }

      // Afficher le score total
      totalscoreEl.textContent = String(total);
      fill.style.width = `${(total / 36) * 100}%`;

      // Afficher la date
      const evalDate = evalDateInput.value;
      const dateObj = new Date(evalDate + 'T00:00:00');
      const dateFormatted = dateObj.toLocaleDateString('fr-FR', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      evalDateDisplay.textContent = `Évaluation du ${dateFormatted}`;

      // Badge de sévérité
      const severity = getSeverityInfo(total);
      severityBadge.innerHTML = `<span class="severity-badge ${severity.class}">${severity.label}</span>`;

      // Interprétation résumée (sévérité)
      interp.textContent = severity.shortDesc;
      interpLong.innerHTML = `<p>${severity.longDesc}</p>`;

      // Probabilité selon critères DSM-5 (dans accordéon)
      const probInfo = getProbabilityInfo(scores);
      probabilityResult.innerHTML = `
        <div class="probability-indicator">
          <div class="probability-circle" style="background: linear-gradient(135deg, ${probInfo.probabilityColor}, ${probInfo.probabilityColor}dd);">
            ${probInfo.probability}
          </div>
          <div class="probability-text">
            <div class="label">Probabilité de TPB selon critères DSM-5</div>
            <div class="desc">${probInfo.probabilityDesc}</div>
            <div class="criteria-count">${probInfo.significantCriteria} critère(s) significatif(s) sur 9</div>
          </div>
        </div>
      `;

      // Scores par critère
      criteriaScores.innerHTML = '';
      criteria.forEach(crit => {
        const score = scores[`q${crit.num}`];
        const card = document.createElement('div');
        card.className = 'criterion-card';
        card.innerHTML = `
          <div class="criterion-header">
            <div class="criterion-name">${crit.num}. ${crit.name}</div>
            <div class="criterion-score">${score} / 4</div>
          </div>
          <div class="criterion-desc">${scaleOptions[score].label} — ${scaleOptions[score].desc}</div>
        `;
        criteriaScores.appendChild(card);
      });

      // Afficher les résultats
      results.style.display = 'block';
      results.scrollIntoView({ behavior: 'smooth' });
      
      // Activer le bouton d'export
      document.getElementById('btn-export').disabled = !document.getElementById('consent').checked;
      return true;
    }

    // Gestion de la soumission
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const answers = {};
      for (const [k, v] of fd.entries()) {
        answers[k] = v;
      }
      computeAndRender(answers);
    });

    // Import
    const fileImport = document.getElementById('file-import');
    fileImport.addEventListener('change', (ev) => {
      const f = ev.target.files?.[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          for (let i = 1; i <= criteria.length; i++) {
            const v = data[`q${i}`];
            if (v !== undefined) {
              const r = document.querySelector(`input[name="q${i}"][value="${v}"]`);
              if (r) r.checked = true;
            }
          }
          computeAndRender(data);
        } catch {
          alert("Fichier invalide.");
        } finally {
          ev.target.value = '';
        }
      };
      reader.readAsText(f);
    });

    // Export
    const consent = document.getElementById('consent');
    const btnExport = document.getElementById('btn-export');
    
    consent.addEventListener('change', () => {
      if (document.getElementById('results').style.display === 'block') {
        btnExport.disabled = !consent.checked;
      }
    });
    
    btnExport.addEventListener('click', () => {
      if (!consent.checked) return;
      const fd = new FormData(form);
      const answers = {};
      let any = false;
      for (const [k, v] of fd.entries()) {
        answers[k] = v;
        any = true;
      }
      if (!any) {
        alert("Veuillez d'abord calculer un résultat.");
        return;
      }
      
      // Ajouter des métadonnées
      const exportData = {
        questionnaire: "ZAN-BPD",
        evaluationDate: evalDateInput.value,
        exportDate: new Date().toISOString(),
        responses: answers
      };
      
      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `zan-bpd_${evalDateInput.value}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
