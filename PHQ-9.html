<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire PHQ-9 - √âvaluation de la Sant√© Mentale</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .navigation-bar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .nav-title {
            font-size: 1.1em;
            color: #2c3e50;
            font-weight: 600;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-button:hover {
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeIn 0.8s ease;
        }

        .header h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.2em;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            animation: slideUp 0.5s ease;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .warning-box h3 {
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .warning-box ul {
            color: #856404;
            margin-left: 20px;
            line-height: 1.6;
        }

        .question-card {
            margin-bottom: 25px;
            padding: 25px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            animation: fadeIn 0.6s ease;
        }

        .question-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.1em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }

        .option-btn {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.95em;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
            transform: scale(1.05);
        }

        .option-score {
            display: block;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .critical-warning {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            color: #721c24;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .results-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-top: 30px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
            display: none;
            animation: slideUp 0.5s ease;
        }

        .results-section.show {
            display: block;
        }

        .score-display {
            text-align: center;
            margin-bottom: 30px;
        }

        .score-circle {
            display: inline-block;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            margin-bottom: 20px;
        }

        .score-number {
            font-size: 3em;
            font-weight: bold;
        }

        .score-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .interpretation {
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }

        .interpretation.minimal { 
            background: #d4edda; 
            color: #155724; 
        }
        .interpretation.mild { 
            background: #fff3cd; 
            color: #856404; 
        }
        .interpretation.moderate { 
            background: #ffe5cc; 
            color: #cc5500; 
        }
        .interpretation.moderate-severe { 
            background: #f8d7da; 
            color: #721c24; 
        }
        .interpretation.severe { 
            background: #f5c2c7; 
            color: #842029; 
        }

        .details-toggle {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .details-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .details-content {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .details-content.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .differential-item {
            background: white;
            padding: 15px;
            border-left: 4px solid #667eea;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .differential-item h4 {
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .differential-item p {
            color: #6c757d;
            font-size: 0.95em;
        }

        .control-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .consent-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .consent-box label {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            cursor: pointer;
        }

        .consent-box input[type="checkbox"] {
            margin-top: 5px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .footer {
            text-align: center;
            padding: 40px 20px;
            color: white;
            margin-top: 50px;
        }

        .footer a {
            color: #ffd700;
            text-decoration: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .options-grid { grid-template-columns: 1fr 1fr; }
            .score-circle { width: 120px; height: 120px; }
            .score-number { font-size: 2.5em; }
            .navigation-bar { 
                flex-direction: column; 
                gap: 10px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation Bar -->
        <div class="navigation-bar">
            <a href="#LIEN_A_MODIFIER" class="back-button">
                ‚Üê Retour
            </a>
            <span class="nav-title">Outils d'√©valuation</span>
        </div>

        <div class="header">
            <h1>üìã Questionnaire PHQ-9</h1>
            <p>√âvaluation de la sant√© mentale</p>
        </div>

        <div class="card">
            <h2>‚ÑπÔ∏è √Ä propos de ce questionnaire</h2>
            <p style="margin: 15px 0; line-height: 1.6;">
                Le PHQ-9 est un outil de d√©pistage valid√© scientifiquement pour √©valuer la pr√©sence et la s√©v√©rit√© 
                des sympt√¥mes d√©pressifs. Il √©value vos exp√©riences au cours des <strong>2 derni√®res semaines</strong>.
            </p>
            
            <div class="warning-box">
                <h3>‚ö†Ô∏è Avertissements importants</h3>
                <ul>
                    <li>Ce questionnaire ne remplace pas une consultation m√©dicale</li>
                    <li>En cas de pens√©es suicidaires, contactez imm√©diatement un professionnel de sant√©</li>
                    <li>Les r√©sultats sont indicatifs et n√©cessitent une interpr√©tation clinique</li>
                    <li><strong>Num√©ro national de pr√©vention du suicide : 3114</strong> (gratuit, 24h/7j)</li>
                </ul>
            </div>
        </div>

        <div class="card">
            <div class="control-buttons">
                <button class="btn btn-primary" onclick="importData()">
                    üì• Importer un questionnaire
                </button>
                <button class="btn btn-secondary" onclick="resetForm()">
                    üîÑ R√©initialiser
                </button>
            </div>
            <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="loadFile(event)">
        </div>

        <div class="card">
            <h2 style="margin-bottom: 20px;">Au cours des 2 derni√®res semaines, selon quelle fr√©quence avez-vous √©t√© g√™n√©(e) par les probl√®mes suivants ?</h2>
            
            <div id="questions"></div>
        </div>

        <div id="functionalImpact" class="card" style="display: none;">
            <h3>Impact fonctionnel</h3>
            <p style="margin: 15px 0;">√Ä quel point ce(s) probl√®me(s) a-t-il (ont-ils) rendu votre travail, vos t√¢ches √† la maison ou votre capacit√© √† vous entendre avec les autres difficile(s) ?</p>
            <div class="options-grid" id="difficultyOptions"></div>
        </div>

        <div id="results" class="results-section">
            <h2 style="text-align: center; margin-bottom: 30px;">üìä R√©sultats de votre √©valuation</h2>
            
            <div class="score-display">
                <div class="score-circle">
                    <span class="score-number" id="totalScore">0</span>
                    <span class="score-label">sur 27</span>
                </div>
            </div>

            <div id="interpretationBox" class="interpretation"></div>

            <button class="details-toggle" onclick="toggleDetails()">
                üìã Voir les d√©tails et diagnostics diff√©rentiels
                <span id="toggleIcon">‚ñº</span>
            </button>

            <div id="detailsContent" class="details-content"></div>

            <div class="card" style="margin-top: 30px;">
                <h3>üíæ Exporter les r√©sultats</h3>
                <div class="consent-box">
                    <label>
                        <input type="checkbox" id="exportConsent">
                        <span>Je consens √† l'exportation de mes donn√©es. Je comprends que ces donn√©es sont sensibles et doivent √™tre prot√©g√©es.</span>
                    </label>
                </div>
                <button class="btn btn-primary" onclick="exportData()" style="width: 100%;">
                    üì• Exporter en JSON
                </button>
            </div>
        </div>

        <div class="footer">
            <p style="font-size: 1.1em; margin-bottom: 15px;"><strong>PHQ-9 - Patient Health Questionnaire</strong></p>
            <p style="font-size: 0.95em; margin-bottom: 10px;">
                <strong>Auteurs originaux :</strong> Dr Robert L. Spitzer, Janet B.W. Williams, Kurt Kroenke et coll√®gues<br>
                D√©velopp√© gr√¢ce √† une allocation d'√©tudes de Pfizer Inc.
            </p>
            <p style="font-size: 0.95em; margin-bottom: 15px;">
                <strong>Adaptation num√©rique :</strong> Dr FENOHASINA | Psychiatre - FFI
            </p>
            <small style="display: block;">¬© 2025 - Tous droits r√©serv√©s</small>
        </div>
    </div>

    <script>
        const questions = [
            "Peu d'int√©r√™t ou de plaisir √† faire les choses",
            "√ätre triste, d√©prim√©(e) ou d√©sesp√©r√©(e)",
            "Difficult√©s √† s'endormir ou √† rester endormi(e), ou dormir trop",
            "Se sentir fatigu√©(e) ou manquer d'√©nergie",
            "Avoir peu d'app√©tit ou manger trop",
            "Avoir une mauvaise opinion de soi-m√™me, ou avoir le sentiment d'√™tre nul(le), ou d'avoir d√©√ßu sa famille ou s'√™tre d√©√ßu(e) soi-m√™me",
            "Avoir du mal √† se concentrer, par exemple, pour lire le journal ou regarder la t√©l√©vision",
            "Bouger ou parler si lentement que les autres auraient pu le remarquer. Ou au contraire, √™tre si agit√©(e) que vous avez eu du mal √† tenir en place par rapport √† d'habitude",
            "Penser qu'il vaudrait mieux mourir ou envisager de vous faire du mal d'une mani√®re ou d'une autre"
        ];

        const options = [
            { value: 0, label: "Jamais" },
            { value: 1, label: "Plusieurs jours" },
            { value: 2, label: "Plus de la moiti√© du temps" },
            { value: 3, label: "Presque tous les jours" }
        ];

        const difficultyOptions = [
            { value: 0, label: "Pas du tout difficile(s)" },
            { value: 1, label: "Assez difficile(s)" },
            { value: 2, label: "Tr√®s difficile(s)" },
            { value: 3, label: "Extr√™mement difficile(s)" }
        ];

        let answers = new Array(9).fill(null);
        let difficulty = null;

        function initializeQuestions() {
            const container = document.getElementById('questions');
            container.innerHTML = '';

            questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-card';
                
                let criticalWarning = '';
                if (index === 8) {
                    criticalWarning = `
                        <div class="critical-warning">
                            üõ°Ô∏è <span>Question sensible - En cas de r√©ponse positive, une aide imm√©diate peut √™tre n√©cessaire</span>
                        </div>
                    `;
                }

                questionDiv.innerHTML = `
                    <span class="question-number">${index + 1}</span>
                    <div class="question-text">${question}</div>
                    <div class="options-grid">
                        ${options.map(opt => `
                            <button class="option-btn" onclick="selectAnswer(${index}, ${opt.value})" id="q${index}_opt${opt.value}">
                                <span class="option-score">${opt.value}</span>
                                <span>${opt.label}</span>
                            </button>
                        `).join('')}
                    </div>
                    ${criticalWarning}
                `;
                
                container.appendChild(questionDiv);
            });
        }

        function initializeDifficulty() {
            const container = document.getElementById('difficultyOptions');
            container.innerHTML = difficultyOptions.map(opt => `
                <button class="option-btn" onclick="selectDifficulty(${opt.value})" id="diff${opt.value}">
                    ${opt.label}
                </button>
            `).join('');
        }

        function selectAnswer(questionIndex, value) {
            answers[questionIndex] = value;
            
            // Update UI
            for (let i = 0; i < 4; i++) {
                const btn = document.getElementById(`q${questionIndex}_opt${i}`);
                if (i === value) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            }

            checkCompletion();
        }

        function selectDifficulty(value) {
            difficulty = value;
            
            // Update UI
            for (let i = 0; i < 4; i++) {
                const btn = document.getElementById(`diff${i}`);
                if (i === value) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            }

            updateResults();
        }

        function checkCompletion() {
            const allAnswered = answers.every(a => a !== null);
            
            if (allAnswered) {
                document.getElementById('functionalImpact').style.display = 'block';
                updateResults();
                document.getElementById('results').classList.add('show');
            }
        }

        function calculateScore() {
            return answers.reduce((sum, val) => sum + (val || 0), 0);
        }

        function getInterpretation(score) {
            if (score <= 4) return { 
                level: "Minimale", 
                className: "minimal",
                description: "Les sympt√¥mes d√©pressifs sont minimes ou absents.",
                action: "Surveillance de routine recommand√©e."
            };
            if (score <= 9) return { 
                level: "L√©g√®re", 
                className: "mild",
                description: "Pr√©sence de sympt√¥mes d√©pressifs l√©gers.",
                action: "Surveillance active et support psychosocial recommand√©s."
            };
            if (score <= 14) return { 
                level: "Mod√©r√©e", 
                className: "moderate",
                description: "Sympt√¥mes d√©pressifs mod√©r√©s n√©cessitant une intervention.",
                action: "Consid√©rer une psychoth√©rapie et/ou un traitement pharmacologique."
            };
            if (score <= 19) return { 
                level: "Mod√©r√©ment s√©v√®re", 
                className: "moderate-severe",
                description: "Sympt√¥mes d√©pressifs mod√©r√©ment s√©v√®res.",
                action: "Traitement actif recommand√© (psychoth√©rapie + pharmacoth√©rapie)."
            };
            return { 
                level: "S√©v√®re", 
                className: "severe",
                description: "Sympt√¥mes d√©pressifs s√©v√®res n√©cessitant une prise en charge urgente.",
                action: "√âvaluation psychiatrique imm√©diate recommand√©e. Consid√©rer l'hospitalisation si risque suicidaire."
            };
        }

        function getDifferentials(score) {
            if (score <= 4) return [];
            if (score <= 9) return [
                { name: "Trouble de l'adaptation", test: "√âvaluer les facteurs de stress r√©cents et leur temporalit√©" },
                { name: "Anxi√©t√© g√©n√©ralis√©e", test: "Utiliser le GAD-7 pour √©valuer les sympt√¥mes anxieux" }
            ];
            if (score <= 14) return [
                { name: "Trouble bipolaire", test: "Rechercher des ant√©c√©dents d'√©pisodes maniaques/hypomaniaques (MDQ)" },
                { name: "Hypothyro√Ødie", test: "Dosage TSH et T4 libre" },
                { name: "Trouble anxieux comorbide", test: "√âvaluation avec GAD-7 et recherche de sympt√¥mes sp√©cifiques" }
            ];
            if (score <= 19) return [
                { name: "Trouble bipolaire", test: "√âvaluation approfondie des ant√©c√©dents thymiques (YMRS, MDQ)" },
                { name: "Trouble d√©pressif avec caract√©ristiques psychotiques", test: "Recherche d'id√©es d√©lirantes ou hallucinations" },
                { name: "Pathologie organique", test: "Bilan biologique complet (NFS, ionogramme, TSH, B12, folates)" },
                { name: "Abus de substances", test: "D√©pistage syst√©matique (AUDIT, CAST)" }
            ];
            return [
                { name: "Trouble d√©pressif avec caract√©ristiques psychotiques", test: "√âvaluation psychiatrique compl√®te (PANSS)" },
                { name: "Trouble bipolaire mixte", test: "Recherche de sympt√¥mes maniaques concomitants" },
                { name: "Trouble de la personnalit√© borderline", test: "√âvaluation de la personnalit√© et des patterns relationnels" },
                { name: "Pathologie neurologique", test: "IRM c√©r√©brale si signes neurologiques ou d√©but tardif" },
                { name: "Syndrome paran√©oplasique", test: "Bilan d'extension si suspicion clinique" }
            ];
        }

        function updateResults() {
            const score = calculateScore();
            const interpretation = getInterpretation(score);
            const differentials = getDifferentials(score);

            document.getElementById('totalScore').textContent = score;
            
            const interpretationBox = document.getElementById('interpretationBox');
            interpretationBox.className = `interpretation ${interpretation.className}`;
            interpretationBox.innerHTML = `
                <h3 style="margin-bottom: 10px;">D√©pression ${interpretation.level}</h3>
                <p><strong>Interpr√©tation :</strong> ${interpretation.description}</p>
                <p><strong>Recommandation :</strong> ${interpretation.action}</p>
            `;

            const detailsContent = document.getElementById('detailsContent');
            if (differentials.length > 0) {
                detailsContent.innerHTML = `
                    <h3 style="margin-bottom: 20px;">Diagnostics diff√©rentiels √† consid√©rer :</h3>
                    ${differentials.map(diff => `
                        <div class="differential-item">
                            <h4>${diff.name}</h4>
                            <p><strong>Comment l'√©valuer :</strong> ${diff.test}</p>
                        </div>
                    `).join('')}
                `;
                document.querySelector('.details-toggle').style.display = 'flex';
            } else {
                document.querySelector('.details-toggle').style.display = 'none';
            }
        }

        function toggleDetails() {
            const content = document.getElementById('detailsContent');
            const icon = document.getElementById('toggleIcon');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                icon.textContent = '‚ñº';
            } else {
                content.classList.add('show');
                icon.textContent = '‚ñ≤';
            }
        }

        function resetForm() {
            answers = new Array(9).fill(null);
            difficulty = null;
            
            // Reset UI
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            document.getElementById('functionalImpact').style.display = 'none';
            document.getElementById('results').classList.remove('show');
            document.getElementById('detailsContent').classList.remove('show');
            document.getElementById('exportConsent').checked = false;
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        function loadFile(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.answers && Array.isArray(data.answers)) {
                            answers = data.answers;
                            difficulty = data.difficulty;
                            
                            // Update UI
                            answers.forEach((value, index) => {
                                if (value !== null) {
                                    selectAnswer(index, value);
                                }
                            });
                            
                            if (difficulty !== null) {
                                selectDifficulty(difficulty);
                            }
                        }
                    } catch (error) {
                        alert("Erreur lors de l'importation du fichier");
                    }
                };
                reader.readAsText(file);
            }
        }

        function exportData() {
            const consent = document.getElementById('exportConsent').checked;
            if (!consent) {
                alert("Veuillez confirmer votre consentement avant d'exporter les donn√©es.");
                return;
            }

            const score = calculateScore();
            const interpretation = getInterpretation(score);
            
            const data = {
                date: new Date().toISOString(),
                answers: answers,
                difficulty: difficulty,
                score: score,
                interpretation: interpretation.level
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `PHQ9_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeQuestions();
            initializeDifficulty();
        });
    </script>
</body>
</html>