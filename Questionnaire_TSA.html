<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Quotient du Spectre Autistique (QA) - Version Interactive</title>
    <style>
        /* --- Google Font --- */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');

        /* --- Variables de Design --- */
        :root {
            --primary-color: #007bff;
            --primary-color-light: #e6f2ff;
            --text-color: #333;
            --light-text-color: #555;
            --bg-color: #f4f7f9;
            --container-bg: #ffffff;
            --border-color: #e0e0e0;
            --danger-color: #dc3545;
            --warning-bg-color: #fff3cd;
            --warning-border-color: #ffeeba;
            --warning-text-color: #856404;
            --success-color: #28a745;
            --font-family: 'Inter', sans-serif;
            font-size: 16px; /* Définit la base pour 1rem */
        }

        /* --- Reset et Styles de base --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 1.25rem;
        }

        /* --- Conteneur Principal --- */
        .questionnaire-container {
            max-width: 50rem;
            margin: 1.25rem auto;
            background-color: var(--container-bg);
            border-radius: 0.75rem;
            box-shadow: 0 0.25rem 1.25rem rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        /* --- Entête et Instructions --- */
        .questionnaire-header {
            padding: 1.875rem 2.5rem;
            background-color: var(--primary-color);
            color: white;
        }
        .questionnaire-header h1 {
            font-size: clamp(1.5rem, 5vw, 1.8rem);
            margin-bottom: 0.3rem;
        }
        .questionnaire-header p { font-size: 1rem; opacity: 0.9; }
        .instructions {
            padding: 1.25rem 2.5rem;
            background: var(--primary-color-light);
            color: var(--primary-color);
            border-bottom: 1px solid var(--border-color);
        }
        
        /* --- Formulaire et Questions --- */
        #aq-form { padding: 1.25rem 2.5rem 2.5rem 2.5rem; }
        .question-block {
            margin-bottom: 1.875rem;
            padding-bottom: 1.25rem;
            border-bottom: 1px solid var(--border-color);
        }
        .question-block:last-of-type { border-bottom: none; margin-bottom: 0; }
        .question-text { font-size: 1.1rem; font-weight: 500; margin-bottom: 1rem; }
        .response-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(10rem, 1fr));
            gap: 0.625rem;
        }
        .response-options input[type="radio"] { display: none; }
        .response-options label {
            display: block;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease-in-out;
            font-size: 0.95rem;
        }
        .response-options label:hover {
            border-color: var(--primary-color);
            background-color: var(--primary-color-light);
        }
        .response-options input[type="radio"]:checked + label {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: 500;
            box-shadow: 0 0.125rem 0.5rem rgba(0, 123, 255, 0.3);
        }

        /* --- Zone d'actions (Calcul, Import/Export) --- */
        .actions-area { margin-top: 2.5rem; display: flex; flex-direction: column; gap: 1.5rem; }
        .submission-area, .io-area {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        #calculate-btn {
            background-color: var(--success-color); color: white; border: none; padding: 1rem 1.875rem;
            font-size: 1.1rem; font-weight: 700; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s;
        }
        #calculate-btn:hover { background-color: #218838; }
        .io-btn {
            background-color: #6c757d; color: white; padding: 0.6rem 1.2rem; border-radius: 0.5rem;
            cursor: pointer; font-size: 0.9rem; font-weight: 500; border: none; transition: background-color 0.2s;
        }
        .io-btn:hover { background-color: #5a6268; }
        #import-json-input { display: none; }
        #validation-message {
            color: var(--danger-color); width: 100%; text-align: center;
            font-weight: 500; display: none;
        }

        /* --- Section des Résultats --- */
        #results-container {
            margin-top: 3rem; padding: 2rem; border: 1px solid var(--border-color);
            border-radius: 0.75rem; display: none; background-color: #fafafa;
        }
        #results-container h2 { text-align: center; margin-bottom: 2rem; font-size: 1.75rem; color: var(--primary-color); }
        .results-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            align-items: center;
        }

        /* --- NOUVEAU: Style de la Jauge --- */
        .gauge-container {
            width: 100%;
            max-width: 18rem; /* 288px */
            aspect-ratio: 2 / 1;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            margin: 0 auto;
        }
        .gauge-arc {
            width: 100%;
            height: 100%;
            background: conic-gradient(from 180deg, #28a745, #ffc107, #dc3545);
            border-radius: 50% 50% 0 0 / 100% 100% 0 0;
            -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 1.5rem), #fff 0);
            mask: radial-gradient(farthest-side, transparent calc(100% - 1.5rem), #fff 0);
        }
        .gauge-needle {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0.25rem;
            height: 45%;
            background-color: var(--text-color);
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(0deg);
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            border-radius: 0.25rem;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .gauge-needle::before {
            content: '';
            position: absolute;
            bottom: -0.75rem;
            left: 50%;
            transform: translateX(-50%);
            width: 1.5rem;
            height: 1.5rem;
            background-color: var(--text-color);
            border-radius: 50%;
            border: 3px solid var(--container-bg);
        }
        .gauge-text-info {
            position: absolute;
            bottom: 1rem;
            text-align: center;
            font-weight: 700;
        }
        .gauge-text-info span { font-size: 2.5rem; line-height: 1; color: var(--text-color); }
        .gauge-text-info small { font-size: 1rem; color: var(--light-text-color); }

        .results-details { flex-grow: 1; }
        .interpretation h3, .warning h4, .json-export-details summary { font-weight: 700; margin-bottom: 0.5rem; }
        .interpretation { margin-bottom: 2rem; }
        .warning {
            padding: 1.25rem; background-color: var(--warning-bg-color); border: 1px solid var(--warning-border-color);
            color: var(--warning-text-color); border-radius: 0.5rem;
        }
        .json-export-details { margin-top: 1.5rem; }
        .json-export-details summary { cursor: pointer; color: var(--primary-color); }
        #json-output {
            background-color: #2d3748; color: #f7fafc; padding: 1.25rem; margin-top: 0.5rem;
            border-radius: 0.5rem; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem; max-height: 25rem; overflow-y: auto;
        }
        
        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .results-content { grid-template-columns: 1fr; }
            .gauge-container { margin-bottom: 2rem; }
        }
        @media (max-width: 600px) {
            body { padding: 0.625rem; }
            .questionnaire-header, #aq-form, .instructions { padding: 1.25rem; }
            .response-options { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="questionnaire-container">
        <header class="questionnaire-header">
            <h1>Le Quotient du Spectre Autistique (QA)</h1>
            <p>Version pour adultes (16 ans et +) - (Baron-Cohen et al., 2001)</p>
        </header>
        
        <div class="instructions">
            <p>Veuillez lire chaque affirmation très attentivement et précisez dans quelle mesure vous êtes d’accord ou pas. <strong>Pour que cette échelle soit valide, vous devez répondre à chaque question.</strong></p>
        </div>

        <form id="aq-form">
            <div id="questions-wrapper"></div>

            <div class="actions-area">
                <div class="submission-area">
                    <button type="submit" id="calculate-btn">Calculer et voir les résultats</button>
                    <p id="validation-message">Veuillez répondre à toutes les questions.</p>
                </div>
                <div class="io-area">
                    <label for="import-json-input" class="io-btn">Importer JSON</label>
                    <input type="file" id="import-json-input" accept=".json">
                    <button type="button" id="export-btn" class="io-btn">Exporter JSON</button>
                </div>
            </div>
            
            <div id="results-container">
                <h2>Vos Résultats</h2>
                <div class="results-content">
                    <div class="gauge-container">
                        <div class="gauge-arc"></div>
                        <div class="gauge-needle" id="gauge-needle"></div>
                        <div class="gauge-text-info">
                            <span id="score-value">0</span><br><small>/ 50</small>
                        </div>
                    </div>
                    <div class="results-details">
                        <div class="interpretation">
                            <h3>Interprétation du score</h3>
                            <p id="interpretation-text"></p>
                        </div>
                        <div class="warning">
                            <h4>Avertissement Important</h4>
                            <p>Ce questionnaire est un outil de dépistage et de recherche, et <strong>ne constitue pas un diagnostic</strong>. Un score élevé peut indiquer la présence de traits autistiques, mais ne confirme pas un diagnostic de trouble du spectre de l'autisme (TSA). De nombreux facteurs peuvent influencer ce score. Si vous avez des questions sur votre santé, veuillez consulter un professionnel de santé qualifié (médecin, psychologue, etc.).</p>
                        </div>
                    </div>
                </div>
                <div class="json-export-details">
                    <details>
                        <summary>Voir les réponses brutes au format JSON</summary>
                        <pre id="json-output"></pre>
                    </details>
                </div>
            </div>
        </form>
    </div>

    <script>
        const questions = [
            "Je préfère réaliser des activités avec d’autres personnes plutôt que seul(e).",
            "Je préfère tout faire continuellement de la même manière.",
            "Quand j’essaye d’imaginer quelque chose, il est très facile de m’en représenter une image mentalement.",
            "Je suis fréquemment tellement absorbé(e) par une chose que je perds tout le reste de vue.",
            "Mon attention est souvent attirée par des bruits discrets que les autres ne remarquent pas.",
            "Je fais habituellement attention aux numéros de plaques d’immatriculation ou à d’autres types d’informations de ce genre.",
            "Les gens me disent souvent que ce que j’ai dit était impoli, même quand je pense moi que c’était poli.",
            "Quand je lis une histoire, je peux facilement imaginer à quoi les personnages pourraient ressembler.",
            "Je suis fasciné(e) par les dates.",
            "Au sein d’un groupe, je peux facilement suivre les conversations de plusieurs personnes à la fois.",
            "Je trouve les situations de la vie en société faciles.",
            "J’ai tendance à remarquer certains détails que les autres ne voient pas.",
            "Je préfèrerais aller dans une bibliothèque plutôt qu’à une fête.",
            "Je trouve facile d’inventer des histoires.",
            "Je suis plus facilement attiré(e) par les gens que par les objets.",
            "J’ai tendance à avoir des centres d’intérêt très importants. Je me tracasse lorsque je ne peux m’y consacrer.",
            "J’apprécie le bavardage en société.",
            "Quand je parle, il n’est pas toujours facile pour les autres de placer un mot.",
            "Je suis fasciné(e) par les chiffres.",
            "Quand je lis une histoire, je trouve qu’il est difficile de me représenter les intentions des personnages.",
            "Je n’aime pas particulièrement lire des romans.",
            "Je trouve qu’il est difficile de se faire de nouveaux amis.",
            "Je remarque sans cesse des schémas réguliers dans les choses qui m’entourent.",
            "Je préfèrerais aller au théâtre qu’au musée.",
            "Cela ne me dérange pas si mes habitudes quotidiennes sont perturbées.",
            "Je remarque souvent que je ne sais pas comment entretenir une conversation.",
            "Je trouve qu’il est facile de « lire entre les lignes » lorsque quelqu’un me parle.",
            "Je me concentre habituellement plus sur l’ensemble d’une image que sur les petits détails de celle-ci.",
            "Je ne suis pas très doué(e) pour me souvenir des numéros de téléphone.",
            "Je ne remarque habituellement pas les petits changements dans une situation ou dans l’apparence de quelqu’un.",
            "Je sais m’en rendre compte quand mon interlocuteur s’ennuie.",
            "Je trouve qu’il est facile de faire plus d’une chose à la fois.",
            "Quand je parle au téléphone, je ne suis pas sûr(e) de savoir quand c’est à mon tour de parler.",
            "J’aime faire les choses de manière spontanée.",
            "Je suis souvent le(la) dernier(ère) à comprendre le sens d’une blague.",
            "Je trouve qu’il est facile de décoder ce que les autres pensent ou ressentent juste en regardant leur visage.",
            "Si je suis interrompu(e), je peux facilement revenir à ce que j’étais en train de faire.",
            "Je suis doué(e) pour le bavardage en société.",
            "Les gens me disent souvent que répète continuellement les mêmes choses.",
            "Quand j’étais enfant, j’aimais habituellement jouer à des jeux de rôle avec les autres.",
            "J’aime collectionner des informations sur des catégories de choses (types de voitures, d’oiseaux, de trains, de plantes, ...).",
            "Je trouve qu’il est difficile de s’imaginer dans la peau d’un autre.",
            "J’aime planifier avec soin toute activité à laquelle je participe.",
            "J’aime les événements sociaux.",
            "Je trouve qu’il est difficile de décoder les intentions des autres.",
            "Les nouvelles situations me rendent anxieux(se).",
            "J’aime rencontrer de nouvelles personnes.",
            "Je suis une personne qui a le sens de la diplomatie.",
            "Je ne suis pas très doué(e) pour me souvenir des dates de naissance des gens.",
            "Je trouve qu’il est très facile de jouer à des jeux de rôle avec des enfants."
        ];

        const responses = [
            { label: 'Tout à fait d’accord', value: 'totally_agree' },
            { label: 'Plutôt d’accord', value: 'slightly_agree' },
            { label: 'Plutôt pas d’accord', value: 'slightly_disagree' },
            { label: 'Pas du tout d’accord', value: 'totally_disagree' }
        ];

        // --- Clé de Scoration pour le QA ---
        const agreeScored = [2, 4, 5, 6, 7, 9, 12, 13, 16, 18, 19, 20, 21, 22, 23, 26, 33, 35, 39, 41, 42, 43, 45, 46];
        const disagreeScored = [1, 3, 8, 10, 11, 14, 15, 17, 24, 25, 27, 28, 29, 30, 31, 32, 34, 36, 37, 38, 40, 44, 47, 48, 49, 50];

        const questionsWrapper = document.getElementById('questions-wrapper');

        // --- Génération dynamique des questions ---
        questions.forEach((qText, index) => {
            const qNum = index + 1;
            const questionBlock = document.createElement('div');
            questionBlock.className = 'question-block';
            let optionsHTML = responses.map(response => `
                <div>
                    <input type="radio" id="q${qNum}_${response.value}" name="q${qNum}" value="${response.value}">
                    <label for="q${qNum}_${response.value}">${response.label}</label>
                </div>
            `).join('');
            questionBlock.innerHTML = `<p class="question-text">${qNum}. ${qText}</p><div class="response-options">${optionsHTML}</div>`;
            questionsWrapper.appendChild(questionBlock);
        });
        
        const form = document.getElementById('aq-form');
        const validationMessage = document.getElementById('validation-message');
        const resultsContainer = document.getElementById('results-container');
        const scoreValue = document.getElementById('score-value');
        const gaugeNeedle = document.getElementById('gauge-needle');
        const interpretationText = document.getElementById('interpretation-text');
        const jsonOutput = document.getElementById('json-output');

        // --- Calcul du score et affichage des résultats ---
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(form);
            const results = {};
            let answeredQuestions = 0;
            for (const [key, value] of formData.entries()) {
                results[key] = value;
                answeredQuestions++;
            }

            if (answeredQuestions < questions.length) {
                validationMessage.style.display = 'block';
                resultsContainer.style.display = 'none';
                return;
            }
            
            validationMessage.style.display = 'none';
            let score = 0;
            for (let i = 1; i <= questions.length; i++) {
                const answer = results[`q${i}`];
                if (agreeScored.includes(i) && (answer === 'totally_agree' || answer === 'slightly_agree')) {
                    score++;
                } else if (disagreeScored.includes(i) && (answer === 'totally_disagree' || answer === 'slightly_disagree')) {
                    score++;
                }
            }

            // Mise à jour de la jauge
            scoreValue.textContent = score;
            const rotation = (score / 50) * 180 - 90; // Convertit le score (0-50) en angle (-90 à 90 deg)
            gaugeNeedle.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
            
            // Mise à jour de l'interprétation
            if (score >= 32) {
                interpretationText.textContent = "Votre score est de " + score + ". Dans les études initiales, un score de 32 ou plus est considéré comme indiquant des traits autistiques cliniquement significatifs. Cela ne constitue pas un diagnostic, mais peut suggérer qu'une discussion avec un professionnel de santé pourrait être pertinente.";
            } else {
                interpretationText.textContent = "Votre score est de " + score + ". Ce score est en dessous du seuil généralement associé à des traits autistiques cliniquement significatifs dans les études de recherche.";
            }

            jsonOutput.textContent = JSON.stringify(results, null, 2);
            resultsContainer.style.display = 'block';
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        });

        // --- Logique d'Import/Export JSON ---
        const importBtn = document.getElementById('import-json-input');
        const exportBtn = document.getElementById('export-btn');

        importBtn.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    for (const [key, value] of Object.entries(data)) {
                        const radio = document.querySelector(`input[name="${key}"][value="${value}"]`);
                        if (radio) radio.checked = true;
                    }
                } catch (error) {
                    window.alert("Erreur: Le fichier JSON est invalide.");
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        });

        exportBtn.addEventListener('click', function() {
            const formData = new FormData(form);
            const results = {};
            let answeredCount = 0;
            for (const [key, value] of formData.entries()) {
                results[key] = value;
                answeredCount++;
            }
            if (answeredCount === 0) {
                window.alert("Veuillez répondre à au moins une question pour exporter.");
                return;
            }
            const dataStr = JSON.stringify(results, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'reponses-aq.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        });

    </script>
</body>
</html>
