<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyseur de Schémas de Young (YSQ-L3)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        details > summary { list-style: none; cursor: pointer; padding: 1rem; transition: background-color 0.2s ease-in-out; }
        details > summary:hover { background-color: #f8fafc; }
        details > summary::before { content: '▶'; margin-right: 0.75rem; font-size: 0.8em; color: #0d9488; transition: transform 0.2s ease-in-out; }
        details[open] > summary::before { transform: rotate(90deg); }
        .focus-visible-ring:focus-visible { outline: 2px solid #0d9488; outline-offset: 2px; }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); padding: 1.5rem; }
        @media (min-width: 768px) { .card { padding: 2rem; } }
        .chart-container { position: relative; height: 80vw; max-height: 500px; width: 100%; }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">

        <!-- En-tête -->
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Analyseur de Schémas de Young</h1>
            <p class="text-lg text-slate-600 mt-2">Un outil pour synthétiser et comprendre vos résultats au YSQ-L3</p>
        </header>
        
        <!-- Avertissement Important -->
        <div class="bg-amber-50 border-l-4 border-amber-500 text-amber-900 p-4 rounded-lg mb-10" role="alert">
            <h2 class="font-bold mb-2">Avertissement Important</h2>
            <p>Cet outil est à but informatif et psychoéducatif. Il ne constitue pas un diagnostic et ne remplace pas l'avis d'un professionnel. Les seuils de couleur sont des indicateurs basés sur la pratique clinique générale et non des normes de validation scientifique strictes.</p>
        </div>

        <!-- Section de Saisie -->
        <div class="card mb-10">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4">
                <h2 class="text-2xl font-semibold text-slate-800 mb-2 sm:mb-0">1. Entrez vos scores</h2>
                <div class="flex flex-wrap gap-2">
                     <button id="importBtn" class="text-sm bg-sky-100 text-sky-700 font-semibold py-2 px-3 rounded-lg hover:bg-sky-200 transition-all">Importer</button>
                     <button id="exportBtn" class="text-sm bg-sky-100 text-sky-700 font-semibold py-2 px-3 rounded-lg hover:bg-sky-200 transition-all">Exporter</button>
                     <button id="fillTestBtn" class="text-sm bg-slate-200 text-slate-700 font-semibold py-2 px-3 rounded-lg hover:bg-slate-300 transition-all">Test</button>
                     <button id="clearBtn" class="text-sm bg-rose-100 text-rose-700 font-semibold py-2 px-3 rounded-lg hover:bg-rose-200 transition-all">Effacer</button>
                     <input type="file" id="importFile" class="hidden" accept=".json">
                </div>
            </div>
            <p class="text-slate-600 mb-6">Pour chaque question, entrez votre score de 1 (totalement faux) à 6 (me décrit parfaitement).</p>
            
            <div id="questions-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-x-4 gap-y-5">
                <!-- Les questions seront générées ici par JavaScript -->
            </div>
            
            <button id="calculateBtn" class="mt-8 w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-700 focus:outline-none focus-visible-ring transition-all shadow-sm">
                Calculer et Analyser les Schémas
            </button>
        </div>

        <!-- Section des Résultats (initialement cachée) -->
        <div id="results-section" class="hidden">
            
            <h2 class="text-3xl font-semibold mb-6 text-slate-800 text-center">2. Vos Résultats</h2>

            <div class="card mb-10">
                <h3 class="text-2xl font-semibold mb-4 text-slate-800">Profil des Schémas (Graphique Radar)</h3>
                <div class="chart-container">
                    <canvas id="schemaChart"></canvas>
                </div>
            </div>

            <div class="card mb-10">
                <h3 class="text-2xl font-semibold mb-4 text-slate-800">Scores Détaillés</h3>
                 <div class="flex flex-wrap gap-x-4 gap-y-2 text-sm mb-6">
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-teal-500 mr-2"></span> Faible (&lt; 2,5)</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-amber-400 mr-2"></span> Modéré (2,5 - 3,9)</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-orange-500 mr-2"></span> Élevé (4,0 - 4,9)</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-rose-500 mr-2"></span> Très élevé (≥ 5,0)</div>
                </div>
                <div id="results-bars" class="space-y-5"></div>
            </div>

            <div class="card mb-10">
                 <h2 class="text-2xl font-semibold mb-4 text-slate-800">3. Comprendre vos Schémas</h2>
                 <p class="text-slate-600 mb-6">Cliquez sur un schéma pour en apprendre plus. Un score élevé suggère que le schéma pourrait être actif.</p>
                 <div id="explanations" class="space-y-2"></div>
            </div>
        </div>

        <div class="card">
            <h2 class="text-2xl font-semibold mb-4 text-slate-800">4. Ressources pour aller plus loin</h2>
            <div class="space-y-8">
                <div>
                    <h3 class="font-semibold text-lg text-slate-900">Vidéos</h3>
                    <div class="mt-4 space-y-4">
                        <div>
                            <p class="mb-1"><strong class="font-medium">Introduction à la Thérapie des Schémas (1/3) par Marion Martinelli :</strong></p>
                            <a href="https://www.youtube.com/watch?v=TxwEHstSLmw" target="_blank" class="text-teal-700 hover:underline break-words">Lien vers la vidéo</a>
                            <p class="text-sm text-slate-500 mt-1"><strong>Apport :</strong> Une excellente introduction générale qui pose les bases de la théorie des schémas, leur origine et leur fonctionnement.</p>
                        </div>
                         <div>
                            <p class="mb-1"><strong class="font-medium">"Pourquoi conseiller cette thérapie?" par Psykocouac :</strong></p>
                            <a href="https://www.youtube.com/watch?v=EPzgumSNMUM" target="_blank" class="text-teal-700 hover:underline break-words">Lien vers la vidéo</a>
                            <p class="text-sm text-slate-500 mt-1"><strong>Apport :</strong> Offre un regard critique et "méta" sur le choix d'une thérapie, pertinent pour comprendre la place de la thérapie des schémas.</p>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="font-semibold text-lg text-slate-900">Livres</h3>
                     <div class="mt-4 text-slate-700 space-y-4">
                        <div><p class="mb-1"><strong class="font-medium">"Je réinvente ma vie" de J. E. Young & J. S. Klosko :</strong> Le livre de référence pour les patients.</p></div>
                        <div><p class="mb-1"><strong class="font-medium">"La thérapie des schémas" de J. Young, J. Klosko, & M. E. Weishaar :</strong> L'ouvrage technique pour les thérapeutes.</p></div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center mt-12 py-4 text-sm text-slate-500">
            <p>Créé avec ❤️ pour favoriser la connaissance de soi.</p>
            <p class="mt-4">
                Le modèle de la Thérapie des Schémas et le questionnaire YSQ ont été développés par le Dr. Jeffrey E. Young. La traduction et l'adaptation du YSQ-L3 sont issues des travaux du Dr. Bernard Pascal. Ce projet est un outil non-officiel.
            </p>
        </footer>
    </div>

    <!-- Modal pour les erreurs -->
    <div id="errorModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full flex items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm mx-auto text-center">
            <h3 class="text-lg font-bold text-red-700 mb-3">Erreur</h3>
            <p id="errorMessage" class="text-slate-700 mb-5"></p>
            <button id="closeModalBtn" class="w-full bg-red-600 text-white font-bold py-2 px-4 rounded-md hover:bg-red-700 focus:outline-none focus-visible-ring">Compris</button>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DATABASE & CONFIG ---
    const schemaMap = {
        ed: { name: "Carence Affective", q: [3, 26, 49, 93, 115, 137, 159, 181, 203, 225], expl: "Le sentiment que vos besoins d'affection, d'écoute et de compréhension n'ont pas été comblés." }, ab: { name: "Abandon / Instabilité", q: [1, 24, 47, 69, 91, 113, 135, 157, 179, 201, 223], expl: "La peur que les personnes importantes vont vous quitter, vous laisser tomber, ou sont imprévisibles." }, ma: { name: "Méfiance / Abus", q: [2, 25, 48, 70, 92, 114, 136, 158, 180, 202, 224], expl: "La conviction que les autres vont vous faire du mal, abuser de vous, ou profiter de vous." }, si: { name: "Isolement Social", q: [4, 27, 50, 71, 94, 116, 138, 160, 182, 204, 226], expl: "Le sentiment d'être différent et de ne faire partie d'aucun groupe, ce qui pousse à s'isoler." }, ds: { name: "Imperfection / Honte", q: [5, 28, 51, 72, 95, 117, 139, 161, 183, 205, 227], expl: "La croyance intime que vous êtes défectueux, mauvais, inférieur ou indésirable." }, fa: { name: "Échec", q: [6, 29, 52, 73, 96, 118, 140, 162, 184, 206, 228], expl: "La croyance que vous êtes fondamentalement incompétent et voué à l'échec." }, di: { name: "Dépendance / Incompétence", q: [7, 30, 53, 74, 97, 119, 141, 163, 185, 207, 229], expl: "Le sentiment d'être incapable de gérer le quotidien sans l'aide considérable des autres." }, vu: { name: "Peur du Danger / Maladie", q: [8, 31, 54, 75, 98, 120, 142, 164, 186, 208, 230], expl: "Une peur exagérée que des catastrophes (médicales, financières...) sont sur le point de se produire." }, eu: { name: "Fusion / Personnalité Atrophiée", q: [9, 32, 55, 76, 99, 121, 143, 165, 187, 209, 231], expl: "Être si impliqué avec autrui que l'on n'a pas développé une identité propre." }, sb: { name: "Droits Personnels Exagérés", q: [10, 33, 56, 77, 100, 122, 144, 166, 188, 210, 232], expl: "La croyance d'être supérieur et d'avoir des droits spéciaux, menant à l'impatience et au manque d'empathie." }, is: { name: "Contrôle de soi / Discipline Insuffisants", q: [11, 34, 57, 78, 101, 123, 145, 167, 189, 211], expl: "Une difficulté à tolérer la frustration et à contrôler ses impulsions pour atteindre un but." }, us: { name: "Assujettissement", q: [12, 35, 58, 79, 102, 124, 146, 168, 190, 212], expl: "Sacrifier ses propres besoins pour plaire aux autres ou pour éviter leur colère et leur rejet." }, et: { name: "Abnégation", q: [13, 36, 59, 80, 103, 125, 147, 169, 191, 213], expl: "Choisir volontairement de répondre aux besoins des autres au détriment des siens, au risque de s'épuiser." }, ss: { name: "Surcontrôle Émotionnel", q: [14, 37, 60, 81, 104, 126, 148, 170, 192, 214], expl: "Inhiber excessivement l'expression de ses émotions, par peur de perdre le contrôle ou de déplaire." }, ei: { name: "Exigences Élevées", q: [15, 38, 61, 82, 105, 127, 149, 171, 193, 215], expl: "La croyance qu'il faut atteindre des standards très élevés pour éviter la critique, menant au perfectionnisme." }, pu: { name: "Punition", q: [16, 40, 62, 84, 106, 128, 150, 172, 194, 216], expl: "La croyance que les gens (y compris soi-même) méritent d'être sévèrement punis pour leurs erreurs." }, as: { name: "Recherche d'Approbation", q: [17, 39, 63, 83, 107, 129, 151, 173, 195, 217], expl: "Une estime de soi qui dépend énormément de l'approbation et de l'attention des autres." }, np: { name: "Négativité / Pessimisme", q: [18, 41, 64, 85, 108, 130, 152, 174, 196, 218], expl: "Une focalisation durable sur les aspects négatifs de la vie tout en minimisant les aspects positifs." }
    };
    const THRESHOLDS = {
        VERY_HIGH: 5.0,
        HIGH: 4.0,
        MODERATE: 2.5
    };
    const COLORS = {
        VERY_HIGH: { tailwind: 'bg-rose-500', rgba: 'rgb(244, 63, 94)' },
        HIGH: { tailwind: 'bg-orange-500', rgba: 'rgb(249, 115, 22)' },
        MODERATE: { tailwind: 'bg-amber-400', rgba: 'rgb(251, 191, 36)' },
        LOW: { tailwind: 'bg-teal-500', rgba: 'rgb(20, 184, 166)' }
    };

    // --- DOM ELEMENTS ---
    const { questionsContainer, calculateBtn, clearBtn, fillTestBtn, importBtn, exportBtn, importFile, resultsSection, resultsBars, explanationsContainer, chartCanvas, errorModal, errorMessage, closeModalBtn } = {
        questionsContainer: document.getElementById('questions-container'), calculateBtn: document.getElementById('calculateBtn'), clearBtn: document.getElementById('clearBtn'), fillTestBtn: document.getElementById('fillTestBtn'), importBtn: document.getElementById('importBtn'), exportBtn: document.getElementById('exportBtn'), importFile: document.getElementById('importFile'), resultsSection: document.getElementById('results-section'), resultsBars: document.getElementById('results-bars'), explanationsContainer: document.getElementById('explanations'), chartCanvas: document.getElementById('schemaChart'), errorModal: document.getElementById('errorModal'), errorMessage: document.getElementById('errorMessage'), closeModalBtn: document.getElementById('closeModalBtn')
    };

    let schemaChartInstance = null;

    // --- INITIALIZATION ---
    function generateQuestionInputs() {
        questionsContainer.innerHTML = Array.from({ length: 232 }, (_, i) => `
            <div class="flex items-center space-x-2">
                <label for="q${i + 1}" class="w-1/2 text-sm text-slate-600 font-medium">Q${i + 1}</label>
                <input type="number" id="q${i + 1}" name="q${i + 1}" min="1" max="6" class="score-input w-1/2 p-2 border border-slate-300 rounded-md text-center focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
            </div>
        `).join('');
    }
    generateQuestionInputs();
    
    const scoreInputs = document.querySelectorAll('.score-input');

    // --- EVENT LISTENERS ---
    clearBtn.addEventListener('click', () => {
        scoreInputs.forEach(input => input.value = '');
        resultsSection.classList.add('hidden');
    });

    fillTestBtn.addEventListener('click', () => {
        scoreInputs.forEach(input => input.value = Math.floor(Math.random() * 6) + 1);
    });

    calculateBtn.addEventListener('click', () => {
        const scoresArray = [];
        if (!validateScores(scoresArray)) return;

        const schemaScores = {};
        Object.keys(schemaMap).forEach(code => {
            const sum = schemaMap[code].q.reduce((acc, qNum) => acc + scoresArray[qNum - 1], 0);
            schemaScores[code] = sum / schemaMap[code].q.length;
        });
        
        displayResults(schemaScores);
        resultsSection.classList.remove('hidden');
        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
    
    importBtn.addEventListener('click', () => importFile.click());
    exportBtn.addEventListener('click', () => {
        const scoresArray = [];
        if (!validateScores(scoresArray)) return;
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify({ scores: scoresArray }));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", `scores-ysq-${new Date().toISOString().slice(0, 10)}.json`);
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    });

    importFile.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const data = JSON.parse(e.target.result);
                if (!data.scores || !Array.isArray(data.scores) || data.scores.length !== 232) throw new Error("Format de fichier invalide.");
                data.scores.forEach((score, index) => {
                    if (score >= 1 && score <= 6) scoreInputs[index].value = score;
                });
            } catch (err) {
                showError("Fichier invalide ou corrompu. Veuillez utiliser un fichier JSON exporté depuis cette application.");
            }
        };
        reader.readAsText(file);
        event.target.value = '';
    });

    closeModalBtn.addEventListener('click', () => errorModal.classList.add('hidden'));

    // --- HELPER FUNCTIONS ---
    function showError(message) {
        errorMessage.textContent = message;
        errorModal.classList.remove('hidden');
    }

    function validateScores(scoresArray) {
        let allAnswered = true;
        scoreInputs.forEach(input => {
            const value = input.value;
            if (value === "" || +value < 1 || +value > 6) allAnswered = false;
            scoresArray.push(Number(value));
        });
        if (!allAnswered) {
            showError("Veuillez répondre à toutes les questions avec un score valide (entre 1 et 6) avant de continuer.");
            return false;
        }
        return true;
    }
    
    function getScoreStyle(score) {
        if (score >= THRESHOLDS.VERY_HIGH) return COLORS.VERY_HIGH;
        if (score >= THRESHOLDS.HIGH) return COLORS.HIGH;
        if (score >= THRESHOLDS.MODERATE) return COLORS.MODERATE;
        return COLORS.LOW;
    }

    // --- DISPLAY FUNCTION ---
    function displayResults(scores) {
        const sortedSchemas = Object.entries(scores).sort(([, a], [, b]) => b - a);
        const chartPointColors = Object.values(scores).map(score => getScoreStyle(score).rgba);
        
        if (schemaChartInstance) schemaChartInstance.destroy();
        schemaChartInstance = new Chart(chartCanvas.getContext('2d'), {
            type: 'radar',
            data: {
                labels: Object.keys(scores).map(code => schemaMap[code].name),
                datasets: [{
                    label: 'Score moyen',
                    data: Object.values(scores),
                    backgroundColor: 'rgba(20, 184, 166, 0.2)',
                    borderColor: 'rgba(20, 184, 166, 0.7)',
                    borderWidth: 2,
                    pointBackgroundColor: chartPointColors,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: { r: { suggestedMin: 0, suggestedMax: 6, ticks: { stepSize: 1 } } },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) label += ': ';
                                if (context.parsed.r !== null) {
                                    label += context.parsed.r.toFixed(2).replace('.', ',');
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });

        resultsBars.innerHTML = '';
        explanationsContainer.innerHTML = '';
        sortedSchemas.forEach(([code, score]) => {
            const detail = schemaMap[code];
            const style = getScoreStyle(score);

            resultsBars.innerHTML += `
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <span class="font-medium text-slate-800">${detail.name} (${code.toUpperCase()})</span>
                        <span class="font-semibold text-slate-900">${score.toFixed(2).replace('.', ',')} / 6</span>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-4 overflow-hidden">
                        <div class="${style.tailwind} h-4 rounded-full" style="width: ${(score / 6) * 100}%"></div>
                    </div>
                </div>`;
            explanationsContainer.innerHTML += `
                <details class="bg-slate-100/70 rounded-lg transition-all">
                    <summary class="font-semibold text-lg text-slate-800 focus:outline-none focus-visible-ring rounded-lg">${detail.name}</summary>
                    <div class="p-4 pt-0"><p class="text-slate-700 leading-relaxed">${detail.expl}</p></div>
                </details>`;
        });
    }
});
</script>

</body>
</html>
